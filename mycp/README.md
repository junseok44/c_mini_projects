# MyCP - File and Directory Copy Utility

`cp` 명령어를 모방한 파일 및 디렉토리 복사 유틸리티입니다. 파일과 디렉토리를 재귀적으로 복사할 수 있습니다.

## 기능

- **파일 복사**: 개별 파일을 다른 위치로 복사
- **디렉토리 복사**: 디렉토리와 하위 내용을 재귀적으로 복사
- **자동 디렉토리 생성**: 대상 디렉토리가 없으면 자동으로 생성
- **지능적 경로 처리**: 대상이 디렉토리인지 파일인지 자동 판단

## 빌드

```bash
make
```

## 사용법

```bash
./bin/mycp <원본> <대상>
```

### 파일 복사

```bash
# 파일을 특정 이름으로 복사
./bin/mycp file.txt backup.txt

# 파일을 디렉토리 안으로 복사 (원본 파일명 유지)
./bin/mycp file.txt backup/

# 파일을 존재하지 않는 디렉토리로 복사 (디렉토리 자동 생성)
./bin/mycp file.txt newdir/
```

### 디렉토리 복사

```bash
# 디렉토리 전체를 다른 위치로 복사
./bin/mycp source_dir/ dest_dir/

# 디렉토리를 기존 디렉토리 안으로 복사
./bin/mycp source_dir/ existing_dir/
```

## 동작 방식

### 원본이 파일인 경우

1. **대상이 존재하지 않음**:
   - 대상 경로가 `/`로 끝나면 → 디렉토리 생성 후 파일 복사
   - 그렇지 않으면 → 파일로 복사

2. **대상이 기존 디렉토리**:
   - 디렉토리 안에 원본 파일명으로 복사

3. **대상이 기존 파일**:
   - 기존 파일을 덮어쓰기

### 원본이 디렉토리인 경우

1. **대상이 기존 파일**:
   - 오류: 디렉토리를 파일에 복사할 수 없음

2. **대상이 존재하지 않음**:
   - 대상 디렉토리 생성 후 내용 복사

3. **대상이 기존 디렉토리**:
   - 내용을 기존 디렉토리에 복사

## 구현 특징

### 파일 복사 (copy_file)
- **스트리밍 복사**: 1024바이트 버퍼로 분할 복사
- **시스템 콜 사용**: `open()`, `read()`, `write()`, `close()`
- **권한 설정**: 복사된 파일에 0644 권한 부여
- **오류 처리**: 각 단계에서 적절한 오류 메시지 출력

### 디렉토리 복사 (copy_dir)
- **재귀적 탐색**: `readdir()`로 디렉토리 내용 탐색
- **자동 분류**: `stat()`로 파일/디렉토리 구분
- **경로 구성**: 동적 메모리 할당으로 경로 문자열 생성
- **특수 항목 스킵**: `.`과 `..` 디렉토리 제외

### 경로 처리
- **동적 할당**: `malloc()`으로 경로 문자열 동적 생성
- **문자열 조작**: `strcpy()`, `strcat()`으로 경로 구성
- **메모리 관리**: 사용 후 `free()`로 메모리 해제

## 프로젝트 구조

```
mycp/
├── src/
│   └── main.c          # 메인 실행 로직
├── bin/
│   └── mycp            # 빌드된 실행 파일
└── Makefile            # 빌드 설정
```

## 예시

### 파일 복사 예시
```bash
# 단순 파일 복사
$ ./bin/mycp document.txt backup.txt

# 디렉토리로 복사 (파일명 유지)
$ ./bin/mycp document.txt backup/
# 결과: backup/document.txt

# 새 디렉토리 생성하며 복사
$ ./bin/mycp document.txt archive/
# 결과: archive/ 디렉토리 생성 → archive/document.txt
```

### 디렉토리 복사 예시
```bash
# 디렉토리 전체 복사
$ ./bin/mycp projects/ backup_projects/

# 기존 디렉토리에 복사
$ mkdir archive
$ ./bin/mycp projects/ archive/
# 결과: archive/ 안에 projects의 모든 내용 복사
```

## 시스템 호출

이 프로젝트에서 사용하는 주요 시스템 호출:

- `open()`: 파일 열기
- `read()`: 파일에서 데이터 읽기
- `write()`: 파일에 데이터 쓰기
- `close()`: 파일 디스크립터 닫기
- `stat()`: 파일/디렉토리 정보 확인
- `mkdir()`: 디렉토리 생성
- `opendir()`: 디렉토리 열기
- `readdir()`: 디렉토리 항목 읽기
- `closedir()`: 디렉토리 닫기

## 오류 처리

- **파일 접근 실패**: 권한 부족, 파일 없음 등
- **메모리 부족**: `malloc()` 실패 시
- **디렉토리 생성 실패**: 권한 부족 등
- **타입 불일치**: 디렉토리를 파일에 복사 시도 등

## 학습 내용

이 프로젝트를 통해 학습할 수 있는 내용:

- **파일 시스템 조작**: 파일/디렉토리 생성, 복사, 탐색
- **시스템 프로그래밍**: 저수준 파일 I/O
- **재귀 알고리즘**: 디렉토리 트리 순회
- **메모리 관리**: 동적 할당과 해제
- **오류 처리**: 시스템 호출 오류 처리
- **경로 조작**: 파일 시스템 경로 문자열 처리
